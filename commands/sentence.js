const fs = require("fs");
const client = require("../discord/discord-client");
const rita = require("rita");
const config = require("../config");

const sourceText = fs.readFileSync("./sentences.txt").toString();
const gen = new rita.RiMarkov(2, true, false);
gen.loadText(sourceText);

const sentence = {
  sentence: (channelId, author, queueId, callback) => {
    if (channelId && author) {
      client.channels.get(channelId).send({
        embed: {
          color: config.palette.pink,
          title: `\`\`\`\n“${gen.generateSentences(1)}”\n\`\`\``,
          description: `*:writing_hand::skin-tone-2: Generated by ${author}*`
        }
      });
      setTimeout(() => {
        callback(null, { queueId: queueId });
      }, 2000);
    }
  },
  tts: (channelId, author, queueId, callback) => {
    if (channelId && author) {
      const sentence = gen.generateSentences(1);
      client.channels
        .get(channelId)
        .send(sentence, { tts: true })
        .then(message => {
          message.edit("", {
            embed: {
              color: config.palette.yellow,
              title: `\`\`\`\n“${sentence}”\n\`\`\``,
              description: `:speak_no_evil: *Generated by ${author}*`
            }
          });
        });
      setTimeout(() => {
        callback(null, { queueId: queueId });
      }, 2000);
    }
  }
};

module.exports = sentence;
